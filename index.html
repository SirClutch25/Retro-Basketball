<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Retro College Hoops — NBA Jam Style</title>
<style>
body{background:#07120a;color:#fff;font-family:monospace;text-align:center}
canvas{background:#083;display:block;margin:12px auto;border:6px solid #000;image-rendering:pixelated}
#ui{max-width:980px;margin:0 auto}
#controls button{margin:6px;padding:8px 12px;background:#111;color:#fff;border:1px solid #666}
#plays{display:flex;gap:6px;justify-content:center;margin:8px}
#info,#bracket,#stats{margin:8px}
#playOverlay{position:fixed;left:50%;top:60%;transform:translate(-50%,-50%);background:#111;border:2px solid #fff;padding:10px;display:none}
</style>
</head>
<body>
<div id="ui">
<h1>Retro College Hoops — NBA Jam Style</h1>
<p>Arrow keys to move, SPACE shoot, P pass, Enter Play Mode to call set plays.</p>
<canvas id="game" width="420" height="560"></canvas>
<div id="info"></div>
<div id="controls">
<button id="enterPlayMode">Enter Play Mode</button>
<button id="subButton">Substitute</button>
<button id="saveBtn">Save</button>
<button id="loadBtn">Load</button>
</div>
<div id="plays"></div>
<div id="bracket"></div>
<div id="stats"></div>
</div>

<div id="playOverlay">
<div><strong>Select a Play</strong></div>
<div id="playOptions"></div>
<div style="margin-top:8px">
<button id="callPlay">Call Play</button>
<button id="cancelPlay">Cancel</button>
</div>
</div>

<script>
// -- Utilities --
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min}

// -- Sprite system --
function drawSprite(x,y,team,action,frame){
ctx.save();
ctx.translate(x,y);
ctx.imageSmoothingEnabled=false;
const bodyColor = team==='home' ? '#FFD37F' : '#7FB3FF';
const shortsColor = team==='home' ? '#663300' : '#003366';
const skin = '#F2C99D';
let armAngle=0, legOffset=0, torsoLean=0, headTilt=0;
if(action==='run'){ armAngle=Math.sin(frame/4)*0.6; legOffset=Math.sin(frame/3)*4; torsoLean=Math.sin(frame/6)*2; }
else if(action==='dribble'){ armAngle=Math.sin(frame/6)*0.4; legOffset=Math.sin(frame/8)*2; }
else if(action==='shoot'){ armAngle=-1.2-(frame/6); headTilt=-0.2; }
else if(action==='dunk'){ armAngle=-1.8-(frame/4); legOffset=-6; torsoLean=-6; }
else { armAngle=Math.sin(frame/12)*0.2; legOffset=0; }
// legs
ctx.fillStyle=shortsColor;
ctx.fillRect(-6,6+legOffset,5,12);
ctx.fillRect(1,6-legOffset,5,12);
// shoes
ctx.fillStyle='#111';
ctx.fillRect(-7,18+legOffset,7,4);
ctx.fillRect(1,18-legOffset,7,4);
// torso
ctx.fillStyle=bodyColor;
ctx.fillRect(-10+torsoLean/3,-8,20,20);
// jersey number
ctx.fillStyle='#000';
ctx.font='bold 8px monospace';
ctx.textAlign='center';
ctx.fillText('8',0,2);
// head
ctx.beginPath(); ctx.fillStyle=skin; ctx.arc(0,-14+headTilt*4,6,0,Math.PI*2); ctx.fill();
ctx.fillStyle='#000'; ctx.fillRect(-2,-16,2,2); ctx.fillRect(2,-16,2,2);
// arms
ctx.strokeStyle=skin; ctx.lineWidth=4;
ctx.beginPath(); ctx.moveTo(-10,-4); ctx.lineTo(-10-Math.cos(armAngle)*14,-4-Math.sin(armAngle)*8); ctx.stroke();
ctx.beginPath(); ctx.moveTo(10,-4); ctx.lineTo(10+Math.cos(armAngle)*14,-4-Math.sin(armAngle)*8); ctx.stroke();
// ball (only if not animating)
if((action==='dribble'||action==='dribble_hold') && !ball.animating){
ctx.fillStyle='#ffb400';
ctx.beginPath(); ctx.arc(12,-4-Math.sin(frame/3)*6,5,0,Math.PI*2); ctx.fill();
ctx.strokeStyle='#000'; ctx.lineWidth=1; ctx.stroke();
}
ctx.restore();
}

// -- Player --
class Player{
constructor(id,x,y,team,control=false){this.id=id;this.x=x;this.y=y;this.team=team;this.control=control;this.hasBall=false;this.action='idle';this.frame=0;this.points=0;this.shots=0;this.made=0;this.assists=0;}
step(){ this.frame++; if(this.frame>10000)this.frame=0;}
draw(){ drawSprite(this.x,this.y,this.team,this.action,this.frame);}
}

// -- Teams --
const court={w:420,h:560};
let homeTeam=[], awayTeam=[];
function createTeams(){
homeTeam=[new Player('H1',110,420,'home',true),new Player('H2',170,430,'home'),new Player('H3',230,430,'home'),new Player('H4',290,430,'home'),new Player('H5',350,430,'home')];
awayTeam=[new Player('A1',110,140,'away'),new Player('A2',170,140,'away'),new Player('A3',230,140,'away'),new Player('A4',290,140,'away'),new Player('A5',350,140,'away')];
homeTeam[0].hasBall=true; homeTeam.forEach(p=>p.action='idle'); awayTeam.forEach(p=>p.action='idle');
}
createTeams();
let ball={x:homeTeam[0].x+12,y:homeTeam[0].y-6,moving:false,dx:0,dy:0,owner:homeTeam[0],animating:false,targetX:0,targetY:0};

// -- Playbook --
let season={week:1,team:{name:'College A',rating:70},opponents:[],bracket:[]};
function generateOpponents(){ season.opponents=Array.from({length:10},(_,i)=>({name:'Team '+(i+1),rating:40+rand(0,40)})); }
generateOpponents();
const playbook=[{id:'iso',name:'Isolation'},{id:'pickroll',name:'Pick & Roll'},{id:'post',name:'Post Up'},{id:'quick',name:'Quick Shot'},{id:'motion',name:'Motion'}];

// -- UI --
const playsDiv=document.getElementById('plays'); 
const playOverlay=document.getElementById('playOverlay'); 
const playOptions=document.getElementById('playOptions'); 
let selectedPlay=null;
function showPlayOverlay(){ 
playOptions.innerHTML=''; 
playbook.forEach(p=>{
const btn=document.createElement('button'); 
btn.textContent=p.name; 
btn.onclick=()=>{ selectedPlay=p; Array.from(playOptions.querySelectorAll('button')).forEach(b=>b.style.outline=''); btn.style.outline='2px solid #fff'}; 
playOptions.appendChild(btn); 
}); 
playOverlay.style.display='block'; 
}
function hidePlayOverlay(){ playOverlay.style.display='none'; selectedPlay=null; }
function refreshPlaysUI(){ playsDiv.innerHTML='Play Mode: Call a play to simulate a set-piece.'; }
refreshPlaysUI();

// -- Score & Timer --
let homeScore=0, awayScore=0;
function updateUI(){
document.getElementById('stats').innerHTML = `<strong>Score</strong> Home ${homeScore} - ${awayScore} Away<br>Week ${season.week}`;
displayBracket();
displayRoster();
}

// -- Display --
function displayBracket(){ const b=document.getElementById('bracket'); let html='<h3>Play Log</h3><ol>'; season.bracket.slice(-12).forEach(x=>{ html+=`<li>W${x.week||''} ${x.play}: ${x.result} ${x.pts? '('+x.pts+')':''}</li>` }); html+='</ol>'; b.innerHTML=html; }
function displayRoster(){ let html='<h3>Roster</h3><div style="display:flex;justify-content:center;gap:12px">'; homeTeam.forEach(p=>{ html+=`<div style="text-align:center">${p.id}<br>PTS:${p.points}</div>` }); html+='</div>'; document.getElementById('stats').innerHTML += html; }

// -- Court --
function drawHoop(x,y){ ctx.fillStyle='#ff4444'; ctx.fillRect(x-20,y,40,6); ctx.fillStyle='#ddd'; ctx.fillRect(x-30,y-8,60,4); }
function drawCourt(){
ctx.fillStyle='#8aa65b'; ctx.fillRect(0,0,court.w,court.h);
ctx.strokeStyle='#ffffffcc'; ctx.lineWidth=3; ctx.strokeRect(10,90,court.w-20,court.h-100);
ctx.beginPath(); ctx.arc(court.w/2,court.h/2,36,0,Math.PI*2); ctx.stroke();
// Hoops
drawHoop(court.w/2,90);  // top
drawHoop(court.w/2,court.h-96); // bottom
// 3pt arcs
ctx.beginPath(); ctx.arc(court.w/2,120,140,0,Math.PI); ctx.stroke();
ctx.beginPath(); ctx.arc(court.w/2,court.h-120,140,Math.PI,Math.PI*2); ctx.stroke();
// Paint
ctx.fillStyle='#d4a017';
ctx.fillRect(court.w/2-60,90,120,110);
ctx.fillRect(court.w/2-60,court.h-200,120,110);
}

// -- Ball movement --
function animateBall(){
if(ball.animating && ball.targetY!==undefined){
let dx = (ball.targetX-ball.x)/8;
let dy = (ball.targetY-ball.y)/8;
ball.x += dx; ball.y += dy;
if(Math.abs(ball.x-ball.targetX)<2 && Math.abs(ball.y-ball.targetY)<2){
ball.animating=false;
if(ball.owner){
if(ball.owner.team==='home'){ homeScore+=2; ball.owner.points+=2; showMessage('Home scores!'); }
else { awayScore+=2; ball.owner.points+=2; showMessage('Away scores!'); }
ball.owner.hasBall=false;
}
setTimeout(()=>{homeTeam[0].hasBall=true; ball.owner=homeTeam[0];},500);
}
}
}

// -- Opponent AI Shoot --
function opponentShoot(){
const shooter = awayTeam[rand(0,awayTeam.length-1)];
if(!ball.animating && !shooter.hasBall){ shooter.hasBall=true; ball.owner=shooter; ball.animating=true; shooter.action='shoot';
ball.targetX = court.w/2; ball.targetY = court.h-96; // home hoop at bottom
setTimeout(()=>{ shooter.hasBall=false; shooter.action='idle'; },500);
}
setTimeout(opponentShoot, rand(2000,4000)); // shoot every 2-4s randomly
}

// -- Controls --
let keys={};
document.addEventListener('keydown',e=>keys[e.key]=true);
document.addEventListener('keyup',e=>keys[e.key]=false);
function handleMovement(){
const me = homeTeam.find(p=>p.control);
const speed = (keys['Shift']?1.8:3.2);
if(keys['ArrowLeft']){ me.x -= speed; me.action='run'; }
if(keys['ArrowRight']){ me.x += speed; me.action='run'; }
if(keys['ArrowUp']){ me.y -= speed; me.action='run'; }
if(keys['ArrowDown']){ me.y += speed; me.action='run'; }
if(!keys['ArrowLeft'] && !keys['ArrowRight'] && !keys['ArrowUp'] && !keys['ArrowDown']){ if(me.action==='run') me.action='idle'; }
me.x = Math.max(30, Math.min(court.w-30, me.x));
me.y = Math.max(100, Math.min(court.h-40, me.y));
// Shoot
if(keys[' '] && me.hasBall && !ball.animating){
me.action='shoot';
ball.animating=true;
ball.targetX = court.w/2;
ball.targetY = me.y<court.h/2 ? 90 : court.h-96;
ball.owner = me;
me.hasBall=false;
}
// Pass
if(keys['p'] && me.hasBall){ const teammate = homeTeam.filter(h=>h!==me)[rand(0,homeTeam.length-2)]; me.hasBall=false; teammate.hasBall=true; teammate.action='dribble'; me.action='idle'; }
}

// -- Messages --
function showMessage(msg){ const info=document.getElementById('info'); info.innerHTML=`<div>${msg}</div>`+info.innerHTML; }

// -- Draw Loop --
function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
drawCourt();
[...homeTeam,...awayTeam].forEach(p=>p.draw());
if(ball.animating || ball.moving){ ctx.fillStyle='#ffb400'; ctx.beginPath(); ctx.arc(ball.x,ball.y,5,0,Math.PI*2); ctx.fill(); ctx.strokeStyle='#000'; ctx.stroke();}
animateBall();
handleMovement();
requestAnimationFrame(draw);
}
draw();

// -- Play Mode & Buttons --
document.getElementById('enterPlayMode').onclick=()=>{ showPlayOverlay(); };
document.getElementById('cancelPlay').onclick=()=>{ hidePlayOverlay(); };
document.getElementById('callPlay').onclick=()=>{ if(selectedPlay){ season.bracket.push({week:season.week,play:selectedPlay.name,result:'Called',pts:0}); hidePlayOverlay(); updateUI(); selectedPlay=null; } };
document.getElementById('subButton').onclick=()=>{ const subFrom = prompt('Substitute: starting player id (e.g. H1)'); const subTo = prompt('Enter new player id (e.g. H6)'); if(!subFrom||!subTo) return; const idx = homeTeam.findIndex(p=>p.id===subFrom); if(idx===-1) return alert('Player not found'); homeTeam[idx].id=subTo; alert('Substitution made'); updateUI(); };
document.getElementById('saveBtn').onclick=()=>{ const state={homeTeam,awayTeam,homeScore,awayScore,season}; localStorage.setItem('retroHoopsSave',JSON.stringify(state)); alert('Saved'); };
document.getElementById('loadBtn').onclick=()=>{ const data=localStorage.getItem('retroHoopsSave'); if(!data) return alert('No save found'); const s=JSON.parse(data); homeTeam=s.homeTeam; awayTeam=s.awayTeam; homeScore=s.homeScore; awayScore=s.awayScore; season=s.season; alert('Loaded'); updateUI(); };

// -- Init --
updateUI();
showMessage('NBA Jam–style sprites enabled with two hoops, mirrored court, and animated shots.');
opponentShoot();
</script>
</body>
</html>
